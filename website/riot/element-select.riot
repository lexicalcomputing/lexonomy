<element-select>
   <select onchange={onChange}
         multiple={props.multiple}>
      <option if={props.showEmptyValue}
            selected={props.riotValue == ""}
            value="">{props.emptyValue || '-select element-'}</option>
      <option if={props.showAnyElement}
            selected={props.riotValue == ".*"}
            value=".*">Any element</option>
      <option each={option in elementOptionList}
            selected={props.multiple ? props.riotValue.includes(option.path) : option.path == props.riotValue}
            value={option.path}>
         <span style="{option.style}">
            {store.getElementDisplayedName(option.path)}
         </span>
      </option>
   </select>

   <script>
      export default{
         onBeforeMount(){
            let elements = window.nvhStore.getElementTreeList(this.props.rootElement)
            if(typeof this.props.includeRootElement == "boolean" && !this.props.includeRootElement){
               elements.shift()
               elements.forEach(element => {element.indent -= 1})
            }
            this.elementOptionList = elements.map(element => {
               return {
                  path: element.path,
                  style: `color: ${element.color}; margin-left: ${element.indent * 15}px`
               }
            })
         },


         onMounted(){
            window.initFormSelects(this.root)
         },

         onUpdated(){
            window.initFormSelects(this.root)
         },

         onChange(evt){
            this.props.onChange && this.props.onChange(evt.target.value, this.props.name)
         }
      }
   </script>

   <style type="scss">
      li span{
         box-sizing: border-box;
      }
   </style>
</element-select>
